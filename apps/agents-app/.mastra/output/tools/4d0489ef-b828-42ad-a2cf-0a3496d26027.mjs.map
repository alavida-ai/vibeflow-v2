{"version":3,"file":"4d0489ef-b828-42ad-a2cf-0a3496d26027.mjs","sources":["../../../src/mastra/tools/workflows/get-next-step.ts"],"sourcesContent":["import { createTool, Tool } from \"@mastra/core\";\nimport { z } from \"zod\";\nimport { getNextStep, getNextStepResultSchema } from \"@brand-listener/agent-sdk\";\n\n// @ts-ignore\nexport const getNextStepTool: Tool = createTool({\n  id: \"get-next-step\",\n  description: \"Resume the current workflow by marking the previous step as completed and return the next suspend payload (next task). Requires an active workflow started with start-workflow.\",\n  inputSchema: z.object({}), // No input needed - uses runtime context\n  outputSchema: getNextStepResultSchema,\n  execute: async ({ runtimeContext }) => {\n    try {\n      \n      const runId = runtimeContext.get(\"current-run-id\") as string;\n      const workflowId = runtimeContext.get(\"workflowId\") as string;\n\n      if (!runId || !workflowId) {\n        throw new Error(\"No runId or workflowId found\");\n      }\n\n      console.log(\"runId\", runId);\n      console.log(\"workflowId\", workflowId);\n\n      const result = await getNextStep({\n        runId: runId,\n        workflowId: workflowId\n      });\n\n      if (result.status === \"suspended\") {\n        return result;\n      } else if (result.status === \"success\") {\n        runtimeContext.delete(\"current-run-id\");\n        runtimeContext.delete(\"workflowId\");\n        return result;\n      } else {\n        runtimeContext.delete(\"current-run-id\");\n        runtimeContext.delete(\"workflowId\");\n        return result;\n      }\n    } catch (error) {\n      console.error(\"Failed to get next step\", error);\n      throw new Error(`Failed to get next step: ${error instanceof Error ? error.message : String(error)}`);\n    }\n  }\n});"],"names":[],"mappings":";;;;;AAKO,MAAM,kBAAwB,UAAA,CAAW;AAAA,EAC9C,EAAA,EAAI,eAAA;AAAA,EACJ,WAAA,EAAa,iLAAA;AAAA,EACb,WAAA,EAAa,CAAA,CAAE,MAAA,CAAO,EAAE,CAAA;AAAA;AAAA,EACxB,YAAA,EAAc,uBAAA;AAAA,EACd,OAAA,EAAS,OAAO,EAAE,cAAA,EAAe,KAAM;AACrC,IAAA,IAAI;AAEF,MAAA,MAAM,KAAA,GAAQ,cAAA,CAAe,GAAA,CAAI,gBAAgB,CAAA;AACjD,MAAA,MAAM,UAAA,GAAa,cAAA,CAAe,GAAA,CAAI,YAAY,CAAA;AAElD,MAAA,IAAI,CAAC,KAAA,IAAS,CAAC,UAAA,EAAY;AACzB,QAAA,MAAM,IAAI,MAAM,8BAA8B,CAAA;AAAA,MAChD;AAEA,MAAA,OAAA,CAAQ,GAAA,CAAI,SAAS,KAAK,CAAA;AAC1B,MAAA,OAAA,CAAQ,GAAA,CAAI,cAAc,UAAU,CAAA;AAEpC,MAAA,MAAM,MAAA,GAAS,MAAM,WAAA,CAAY;AAAA,QAC/B,KAAA;AAAA,QACA;AAAA,OACD,CAAA;AAED,MAAA,IAAI,MAAA,CAAO,WAAW,WAAA,EAAa;AACjC,QAAA,OAAO,MAAA;AAAA,MACT,CAAA,MAAA,IAAW,MAAA,CAAO,MAAA,KAAW,SAAA,EAAW;AACtC,QAAA,cAAA,CAAe,OAAO,gBAAgB,CAAA;AACtC,QAAA,cAAA,CAAe,OAAO,YAAY,CAAA;AAClC,QAAA,OAAO,MAAA;AAAA,MACT,CAAA,MAAO;AACL,QAAA,cAAA,CAAe,OAAO,gBAAgB,CAAA;AACtC,QAAA,cAAA,CAAe,OAAO,YAAY,CAAA;AAClC,QAAA,OAAO,MAAA;AAAA,MACT;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,2BAA2B,KAAK,CAAA;AAC9C,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,yBAAA,EAA4B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAE,CAAA;AAAA,IACtG;AAAA,EACF;AACF,CAAC;;;;"}